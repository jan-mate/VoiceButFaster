default_platform(:android)

platform :android do
  lane :ci do
    build_apks
    unit_tests
  end

  lane :build_apks do
    gradle(task: 'app:assembleProprietaryRelease -x lint -x lintVitalProprietaryRelease')
    copy_artifacts(
      target_path: 'artifacts' + '/apk',
      artifacts: ['app/build/outputs/apk/*/release/*.apk', 'app/build/outputs/mapping/*/release/mapping.txt']
    )
  end

  lane :unit_tests do
    gradle(task: 'app:testProprietaryDebugUnitTest common:testDebugUnitTest data:testDebugUnitTest')
  end
end
